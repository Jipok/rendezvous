<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rendezvous Key-Value Server</title>
    <style>
        :root {
            --background-color: #ffffff;
            --text-color: #333333;
            --header-color: #222222;
            --link-color: #0366d6;
            --code-background: #f6f8fa;
            --border-color: #e1e4e8;
            --table-stripe: #f6f8fa;
            --github-icon-color: #333333;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --background-color: #121212;
                --text-color: #e0e0e0;
                --header-color: #ffffff;
                --link-color: #58a6ff;
                --code-background: #1e1e1e;
                --border-color: #30363d;
                --table-stripe: #1c1c1c;
                --github-icon-color: #e0e0e0;
            }
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            background-color: var(--background-color);
            color: var(--text-color);
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            margin-bottom: 10px; 
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        h1, h2, h3, h4 {
            color: var(--header-color);
            margin: 1.5rem 0 1rem 0;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-top: 0;
        }
        
        h2 {
            font-size: 1.8rem;
            margin-top: 2rem;
        }
        
        a {
            color: var(--link-color);
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        ul {
            margin-left: 2rem;
            margin-bottom: 1.5rem;
        }
        
        li {
            margin-bottom: 0.5rem;
        }
        
        pre {
            background-color: var(--code-background);
            border-radius: 4px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
            border: 1px solid var(--border-color);
        }
        
        code {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            color: inherit;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }
        
        table, th, td {
            border: 1px solid var(--border-color);
        }
        
        th, td {
            padding: 10px 15px;
            text-align: left;
        }
        
        thead {
            background-color: var(--code-background);
        }
        
        tbody tr:nth-child(even) {
            background-color: var(--table-stripe);
        }
        
        .emoji {
            margin-right: 5px;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 15px;
            }
            
            pre {
                font-size: 0.9rem;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .github-link {
            display: flex;
            align-items: center;
            margin-left: 15px;
            position: relative;
            top: -3px;
        }

        .github-icon {
            fill: var(--github-icon-color);
            transition: transform 0.2s ease;
        }

        .github-link:hover .github-icon {
            transform: scale(1.1);
        }

    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <h1>Rendezvous Key-Value Server</h1>
            <a href="https://github.com/Jipok/rendezvous" target="_blank" class="github-link" title="View on GitHub">
                <svg height="42" width="42" viewBox="0 0 16 16" version="1.1" aria-hidden="true" class="github-icon">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
        </div>
    </header>
    
    <main>
        <p>A lightweight, public key-value store server designed as a rendezvous/bootstrap point for mesh networks, distributed applications, and general-purpose key-value storage without registration.</p>
        
        <h2><span class="emoji">üåê</span> Public Instance</h2>
        <p>A public instance is available at: <a href="https://rendezvous.jipok.ru" target="_blank" class="host-url">https://rendezvous.jipok.ru</a></p>
        <ul>
            <li>Key limit: 100 bytes</li>
            <li>Value limit: 1000 bytes</li>
            <li>Rate limit: 11 tokens per minute (POST=3 tokens, GET=1 token)</li>
            <li>Expire time: 2 hours</li>
        </ul>
        
        <h2><span class="emoji">üöÄ</span> API Usage</h2>
        <h3>Store a Value</h3>
        <pre><code>curl -X POST -d "your-data-here" {CURRENT_HOST}/your-key</code></pre>
        <p>The expiration time for a key is reset with every successful POST request, extending its lifetime.</p>
        
        <h3>Retrieve a Value</h3>
        <pre><code>curl {CURRENT_HOST}/your-key</code></pre>

        <h3>Protecting Values with Owner Secret</h3>
        <p>You can protect your values from modification by adding the <code>X-Owner-Secret</code> header when posting:</p>
        <pre><code># Store a value with owner protection
curl -X POST -d "your-protected-data" -H "X-Owner-Secret: your-secret-here" {CURRENT_HOST}/your-key

# Update a protected value (requires the same secret)
curl -X POST -d "your-new-data" -H "X-Owner-Secret: your-secret-here" {CURRENT_HOST}/your-key

# This will be rejected if the secret doesn't match
curl -X POST -d "unauthorized-update" -H "X-Owner-Secret: wrong-secret" {CURRENT_HOST}/your-key</code></pre>
        <p>Anyone can still read the value, but only someone with the correct secret can modify it.</p>
        <p><strong>Note</strong>: The secret and the value together must not exceed the maximum value size limit (1000 bytes by default).</p>

        <h3>IP-Protected Keys</h3>
        <p>For paths prefixed with <code>/ip/</code>, the server automatically injects the client's IP address into the key:</p>
        <pre><code># If your client IP is 20.18.12.10, this actually stores the value under
# the key "ip/20.18.12.10/service1" automatically
# The response will return your public IP address instead of "OK".
curl -X POST -d "my-server-info" {CURRENT_HOST}/ip/service1

curl {CURRENT_HOST}/ip/20.18.12.10/service1</code></pre>
        <p>This feature makes it easy for servers to publish information that only they can modify, without needing to know their public IP in advance. Stored key is automatically prefixed with client's IP, preventing others from overwriting the data.</p>

        <h2><span class="emoji">üìã</span> Use Cases</h2>
        <ul>
            <li><strong>Peer Discovery</strong>: Help distributed systems and mesh networks discover initial peers</li>
            <li><strong>Configuration Distribution</strong>: Share configuration files or bootstrap information</li>
            <li><strong>Temporary Data Exchange</strong>: Easy way to share ephemeral data between systems</li>
            <li><strong>IoT Device Coordination</strong>: Simple communication point for IoT devices</li>
            <li><strong>Secure Self-Identification</strong>: Servers can publish their details under IP-protected keys</li>
        </ul>
        
        <h2><span class="emoji">üîß</span> Self-hosted</h2>
        <h3>Using prebuilt</h3>
        <pre><code>wget https://github.com/Jipok/rendezvous/releases/latest/download/rendezvous-server
chmod +x rendezvous-server
./rendezvous-server</code></pre>
        
        <h3>Using Go</h3>
        <pre><code>git clone https://github.com/Jipok/rendezvous
cd rendezvous
go build
./rendezvous-server</code></pre>
        
        <h2><span class="emoji">üîë</span> Features</h2>
        <ul>
            <li><strong>No Registration</strong>: Just use it directly, no accounts needed</li>
            <li><strong>Simple HTTP API</strong>: Store and retrieve values with basic HTTP GET/POST requests</li>
            <li><strong>Ephemeral Storage</strong>: Keys automatically expire after configured time</li>
            <li><strong>Rate Limited</strong>: Basic protection against abuse (token-based rate limiting per IP)</li>
            <li><strong>Configurable Limits</strong>: Adjustable key/value sizes and storage capacity</li>
            <li><strong>Zero Dependencies</strong>: Just the server, no databases needed</li>
            <li><strong>Value Protection</strong>: Optional secret-based protection for value updates</li>
        </ul>
        
        <h2><span class="emoji">‚öôÔ∏è</span> Configuration</h2>
        <table>
            <thead>
                <tr>
                    <th>Flag</th>
                    <th>Default</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>-maxKeySize</td>
                    <td>100</td>
                    <td>Maximum key length in bytes</td>
                </tr>
                <tr>
                    <td>-maxValueSize</td>
                    <td>1000</td>
                    <td>Maximum value size in bytes (including secret)</td>
                </tr>
                <tr>
                    <td>-maxNumKV</td>
                    <td>100000</td>
                    <td>Maximum number of key-value pairs</td>
                </tr>
                <tr>
                    <td>-expireDuration</td>
                    <td>2h</td>
                    <td>Time after which keys expire</td>
                </tr>
                <tr>
                    <td>-resetDuration</td>
                    <td>1m</td>
                    <td>Duration between rate limit resets</td>
                </tr>
                <tr>
                    <td>-saveDuration</td>
                    <td>30m</td>
                    <td>Duration between state saves</td>
                </tr>
                <tr>
                    <td>-maxRequests</td>
                    <td>11</td>
                    <td>Maximum request tokens per IP (POST=3 tokens, GET=1 token)</td>
                </tr>
                <tr>
                    <td>-port</td>
                    <td>80</td>
                    <td>Server port</td>
                </tr>
                <tr>
                    <td>-l</td>
                    <td>0.0.0.0</td>
                    <td>Interface to listen on</td>
                </tr>
                <tr>
                    <td>-disableLocalIPWaring</td>
                    <td>false</td>
                    <td>Disable warnings about requests from localhost</td>
                </tr>
            </tbody>
        </table>
        
        <p>Example:</p>
        <pre><code>./rendezvous-server -maxValueSize 4096 -expireDuration 24h -port 9000</code></pre>
        
        <h2><span class="emoji">‚ö†Ô∏è</span> Limitations</h2>
        <ul>
            <li><strong>Ephemeral Storage</strong>: All data is temporary and will be deleted after expiration</li>
            <li><strong>No Encryption</strong>: Data is stored and transmitted without encryption(except TLS)</li>
            <li><strong>Size Limits</strong>: Value size limit includes owner secret if used</li>
            <li><strong>IPv4 Only</strong>: For rate-limit purpose supports only IPv4 addresses</li>
        </ul>
    </main>

    <script>
        // Replace all occurrences of the {CURRENT_HOST} with the current host
        document.addEventListener('DOMContentLoaded', function() {
            const currentHost = window.location.protocol + '//' + window.location.host;
            document.body.innerHTML = document.body.innerHTML.replace(new RegExp('{CURRENT_HOST}', 'g'), currentHost)
        });
    </script>
</body>
</html>
